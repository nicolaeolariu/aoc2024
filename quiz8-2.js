const source = [
'...s..............................................',
'...................w......K.......t...............',
'........s.........................................',
'.......s......w...............1...................',
'.........w5.......................................',
'.......................t.F........................',
'..................................................',
'F................................1...........d....',
'.........................5......................K.',
'............5.................R..............KZ...',
'....F.....q.........w..............1.....t........',
'............8.......I.............................',
'..........8.................t....................K',
'...........8.................5.....Z..............',
'.........q..............................Z...d..U..',
'...................Y.q...R........................',
'....................E.....z...............y.......',
'..........................................U.......',
'.....F.................................k........S.',
'............q...................d.................',
'.................................R................',
'..x....................................U.........y',
'.......x.........................E..M...U..d......',
'......z.......X............................4......',
'...............I....m....M......R............y....',
'.......z...................................k..e...',
'..f..z.......................................e....',
'...f.I..........7..u..........M................D..',
'.......X..I.......x.................k.............',
'.........X.......7....................4.......S...',
'....................u9...T.....3.Z....o..........6',
'........f.......D..3....u..................S......',
'...W...0.........................................D',
'.....................T................E.......m...',
'...8....Y............f........T4..................',
'......Y...........................................',
'....0.............3...............................',
'....................3.T.....................k.....',
'.......................u..............6...........',
'...........................6..........9........e..',
'..................4....7.............o..........D.',
'.................................M...E..o.........',
'...i.................O...........................Q',
'.....0.i.....................................m.2..',
'.......Y.r........7..............S..O..2.......m..',
'.....r......0.............O.......................',
'..................................Q...............',
'........................6................o......Q.',
'..W...r.................................9.........',
'.W.........................O........2.............',
]
// const source = [
// '............',
// '........0...',
// '.....0......',
// '.......0....',
// '....0.......',
// '......A.....',
// '............',
// '............',
// '........A...',
// '.........A..',
// '............',
// '............',
// ];
// const source = [
// 'T.........',
// '...T......',
// '.T........',
// '..........',
// '..........',
// '..........',
// '..........',
// '..........',
// '..........',
// '..........',
// ];
console.time('run:')

// Init
const map = source.map(a => a.split(''));
const height = map.length;
const width = map[0].length;

let antinodes = [];

const getAntennas = () => {
  const antennas = {};
  map.forEach((row, x) => {
    row.forEach((val, y) => {
      if(val !== '.') {
        antennas[val] = antennas[val] || [];
        antennas[val].push([x, y]);
      }
    });
  });
  return antennas;
}
const onlyUnique = (value, index, self) => {
  return self.indexOf(value) === index;
}
const addAntinode = (point1, point2) => {
  let diffX = point2[0] - point1[0];
  let diffY = point2[1] - point1[1];
  const x = point2[0] + diffX;
  const y = point2[1] + diffY;
  if(x >= 0 && x < height && y >= 0 && y < width) {
    return [x, y];
  }
  return null
}

const antennas = getAntennas();
console.log(antennas);

for(let antena in antennas) {
  antennas[antena].forEach(position => {
    antinodes.push(position[0] + ',' + position[1])
    for(let i=0; i < height; i++) {
      for(let j=0; j < width; j++) {
        if(map[i][j] === antena && i !== position[0] && j !== position[1]) {
          let validPoint;
          let point1 = position;
          let point2 = [i, j];
          do {
            validPoint = addAntinode(point1, point2);
            if(validPoint && antinodes.indexOf(validPoint[0] + ',' + validPoint[1]) === -1) {
              console.log('Add Point: ', validPoint[0] + ',' + validPoint[1], ' from position: ', position, [i, j])
              antinodes.push(validPoint[0] + ',' + validPoint[1]);
            }
            point1 = point2;
            point2 = validPoint;
          }while(validPoint);
        }
      }
    }
  });
}

// Display result
map.forEach((line, k) => {
  let row = "";
  line.forEach((val, o)=> {
    let isAntinode  = false;
    antinodes.forEach(point => {
      const p = point.split(',');
      if(parseInt(p[0]) === k && parseInt(p[1]) === o) {
        isAntinode = true;
      }
    })
    row+=isAntinode && val === '.' ? '#' : val;
  })
  console.log(row)
})

antinodes = antinodes.filter(onlyUnique)
console.log(antinodes);
console.log(antinodes.length);
console.timeEnd('run:')