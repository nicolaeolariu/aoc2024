console.time('run:')

let mapInput = [
'#############################################################################################################################################',
'#.....#...#.............#.....#.............#...#.....#.............................#...................#...#.............#...........#...#E#',
'###.#.#.#.###.#.#########.###.#.#.#####.###.#.#.#.###.#.#########.#.#.#.#.#.#######.#.#########.###.#####.#.#.#####.#####.#.#.#######.#.#.#.#',
'#...#.#.#...#.#.......#...#.#...#.......#...#.#.#.#.#.#.......#...#...#.#...#.....#...#.......#.#.....#...#...#...#.#...#.#.#.#.....#...#...#',
'#.#.#.#.###.#########.#.###.###########.#.###.#.#.#.#.#.#####.#.#######.###.#.###.#.###.###.#.#.#.#.#.#.#########.#.#.#.#.#.#.#.###########.#',
'#...#...#.#.#.....#...#.........#...............#...#.#.#...#.#.......#.......#...#...#.#...#.#...#...#...#.......#...#.#.#.#.#.........#...#',
'#.#.#####.#.#.###.#.#.###.#####.#.#.#.#.###.#.#.###.#.#.#.#.#########.#####.###.###.###.#.#.#######.#####.###.###.#####.###.#.#####.###.#.###',
'#.#...#.#...#.#...#.#.#...#...#.#.#.#...#...#.#.....#...#.#.........#.#.....#...#.......#.#.#.....#.....#...#.#.#.#.....#...#...#...#.#.#...#',
'#.#.#.#.#.###.#.###.###.###.#.#.#.#.###.#.###.###########.#########.#.#.###.#.#####.#####.###.###.#.###.###.#.#.#.#.#####.###.#.#.###.#.###.#',
'#...#.#...#...#...#.....#...#.#...#...#...#.......#.......#.........#.....#.#.......#...#.....#.....#.#.....#.#...#.......#.#...#...........#',
'###.#.#.#####.###.#.#.###.###.#######.#.###.###.#.#.#######.###############.###.#.#.#.#.###.###.###.#.#######.#############.#.###.#.#.###.###',
'#.#...........#.#...#.#...#.#...#...#.........#.#...#.....#.#.............#.......#...#...#.#...#.#...#...#.........#.......#...#.#.#...#...#',
'#.#.#.#########.###.###.###.#.#.#.#.###.#.#####.###.#####.#.#####.#.#####.#.#.#.#.#.#####.###.###.#.#.###.#.#####.#.#######.#.#.#.#.#######.#',
'#...#.#.#.........#.#...#.......#.#.....#...#...#...#...#.......#.#.....#.....#.........#...#.#...#...#...#.#.....#.........#.#.#.#.#.......#',
'#####.#.#.#####.#.#.#.###.###.###.#####.#####.###.###.#.#######.#.#####.###.###.#.#####.###.#.###.#.###.#.#.#.#####.#######.#.#.#.#.#.#######',
'#.....#.....#...#.#.#...#.........#...#.......#.....#.#...#.....#.....#.#...#.......#...#...#...#.......#.#.#...#.......#...#.#.#.#.#...#...#',
'#.#####.#####.#####.###.###########.#.#####.#########.###.###.###.#####.###.#.#.#.#.#.###.###.#.#.#########.###.###.#.#.#.###.#.#.#.###.#.###',
'#.#...#.#...#.#.....#...#.......#...#.#...............#.#...#.#...#.....#.....#...#.#...#...#.#...............#...#...#.#...#.#.#.#.....#...#',
'#.###.#.#.#.#.#.#####.#######.###.###.#.#####.#########.###.#.#####.###.#.#####.#######.###.###.#################.#####.###.#.#.#####.###.#.#',
'#...#.#.#.#...#...#.#.......#.......#...#.....#...........#.#.....#...#.#.....#.#.....#...#...#.#.#...............#.....#...#.#.....#.....#.#',
'###.#.#.#.#######.#.#.#####.#######.#####.###############.#.#####.#.#.#.#####.#.#.###.###.###.#.#.#.#.#.###########.#####.###.#####.#####.#.#',
'#...#...#.....#...#...#.#...#...#...#...#.#.......#.....#.#...#.....#.#...#...#.#...#...#...#.#...#.#.#.#...#.....#.....#...#.....#.....#.#.#',
'#.#####.#####.#.###.###.#.###.#.#.###.#.#.#.#.###.#.###.#.###.#.###.#.#####.###.###.###.###.#.###.#.#.#.#.#.#.#.###.###.###.###.#.###.#.#.#.#',
'#.....#.#...#...#...#...#.....#.#.....#.#...#.#.....#.....#...#...#.#...#...#.....#...#.....#.....#.#.#.#.#...#.#...#.#...#.....#...#...#...#',
'#####.#.#.#.#####.#####.#######.#####.#####.#.#########.###.#####.#.###.#.#####.#.###.#########.#.#.#.#.#.#####.#.###.###.#######.#.#.###.#.#',
'#.....#.#.#.............#.....#.#.#...#...#.#.#.......#.....#.....#...#.#.....#.#...#...........#.#.#...#.#.....#...#.......#.......#.#.#...#',
'#.#####.###############.#.#.###.#.#.###.#.#.#.#.#####.###.###.#.#######.#####.#.#########.#.#.###.#.#####.#####.###.#.#####.#.#######.#.#.###',
'#...#...............#.#.#.#...#.#...#...#.....#...#.#.#...#.............#.#...#.........#.#...#...#.#...............#.....#.#.#...#...#.....#',
'#.#.###.#.#########.#.#.###.#.#.#####.#######.###.#.#.#.#########.#.###.#.#.###.#####.#.#.###.#.#.#.#.###########.###.#.#.#.#.#.###.#.###.###',
'#.#...#...#.....#.#.#.........#.......#.....#...#.#.....#.......#...#.#...#.#...#.....#...#...#...#.#.....#.....#...#.#.#.#.#...#...#.#.....#',
'#.###.#.###.###.#.#.#########.#########.###.###.#.#####.#.#####.#####.###.#.#####.#.###.#.#.#.###.#.###.###.###.###.#.#.###.###.#.###.#.#.#.#',
'#.#...#...........#.................#.#...#.#...#...#...#.#...#.....#.....#.......#.#...#...#...#.#.#...#...#.#.#.#.#.#...#...#.#.#...#.#...#',
'#.#.###.#.#######.#########.#.#####.#.###.#.#####.#.#####.#.#.#####.#######.#######.#.#####.###.###.#.###.###.#.#.#.#####.#.###.#.#.###.#.###',
'#.#.#...#.....#...#...#...#.#.....#...#...#.#...#.#.....#.#.#...#...#.......#.....#.#.#.....#.......#...#.....#.#.#.......#.#...#.#...#.#...#',
'#.#.###.#####.#####.#.#.#.#.#.#.#.#.###.###.#.#.#.#####.#.###.###.###.###.###.###.#.#.#######.###.#.#########.#.#.#.#######.#.###.#####.###.#',
'#.#...#.....#...#...#...#...#...#.#.#...#.....#.#...#...#...#...#.....#...#...#...#.#.#...........#.#.......#.#.#...#.......#...#.......#...#',
'#####.#####.###.#.#.###########.#.###.#.#######.#####.#####.###.#######.#.#.###.###.#.#.#.###.###.###.#####.#.#.#####.#########.#########.#.#',
'#.....#.....#.#...#.#...........#.....#.#.....#.......#...#.....#...#...#.#...#...#.#.....#.....#.........#...#.#...#...#...#...#...#...#.#.#',
'#.#####.#####.#####.#.###.###########.###.###.#####.#.#.#.#####.#.#.#.###.###.###.#.#.###.#.###.#####.#####.###.#.#.###.#.#.#.#####.#.#.#.#.#',
'#.........#.........#...#...#.....#...#.....#.#...#.#...#.....#.#.#...#...#.......#.#...#...#.#.......#...#...#...#...#...#.#.#.....#.#...#.#',
'#.###.#.#.#.#####.#####.###.#.#.#.#.###.#####.#.#.#.#.#####.###.#.#.#######.###.###.#.#.#####.#####.###.#.###.#######.#.###.#.#.###.#.#####.#',
'#...#.#...#.....#...#...#.#.#...#.....#.#.......#...#.#...#...#...#.#.......#.........#.#.#.......#.#...#...#...#...#.#...#...#.#...#.....#.#',
'#.#.#.#.#.#####.###.#.###.#.#####.#####.#.###.#######.#.#.#.#.#.#.###.###.#############.#.#.#####.#.#.#####.###.#.#.#.#.#.#####.#.#######.#.#',
'#...#.#...........#...#...#.#.....#.....#.#...#.......#.#...#.#...#...#...#...#...#...#.#.......#...#...#.#.#.....#.#...#...#...#...#...#.#.#',
'###.#.#.#.###.###.#####.#.#.#.#.###.#####.#.###.#######.#.###.###.#.#######.#.#.#.###.#.#.#####.#######.#.#.#.#####.###.###.#.#####.#.#.#.#.#',
'#...#.#.......#...#.....#.#...#...#.#...#.#...#.#.......#.#.....#.#...#...#.#...#.#...#.....#...........#...#...#.......#...#...#.....#.#.#.#',
'#.###.#.#.#.#####.#.#########.###.#.###.#.#####.#.#####.###.#.###.###.#.#.#.#.###.#.#######.#.###########.#####.#########.###.#.#########.###',
'#...#.#.....#...#...#.......#.#...#...#.#.......#.#...#.#...#.#...#.#...#.......#.#...#.....#.#.....#.....#...#...#.....#.#...#.........#...#',
'#####.#.#.###.#.#####.#####.#.#.#.###.#.#####.#.#.#.#.#.#.#####.###.#############.#.#.#.#######.###.###.###.#.#.#.###.###.###########.#.###.#',
'#...#...#.....#...#...#...#.#.#.#...#.#...#.......#.#...#.#...#.#.......#.#.......#.#...#.......#.#...#...#.#.#.#...#.......#.......#.#...#.#',
'#.#.###.#.#.#.###.#.###.#.#.#.#.#.###.#.#.#.#######.#####.#.#.#.#.#####.#.#.#######.#######.#####.###.#.#.#.#.#####.#.#####.#.#####.###.#.#.#',
'#.#.....#.....#...#.#...#.#.....#.....#.#.#.........#...#...#...#.#...#...#.#.....#.........#.......#.......#.......#.#...#...#...#...#.#.#.#',
'#.###.###.###.###.#.#####.#######.#.###.#######.###.#.#.#########.###.###.#.#.###############.#####.#.###########.#####.#.#######.###.#.###.#',
'#.#...#...#.#...#.#...#.......#...#...#.#.....#.....#.#.....#.......#...#.#.#.................#...#.#.............#.....#.#.........#...#...#',
'#.#####.#.#.#.#.#.###.#.#######.#####.#.#.#.#########.#.#####.#####.#.#.#.#.#.#####.#####.#####.#.#############.###.#####.#.#.#########.#.#.#',
'#.....#.#.....#.#.....#.........#.....#.#.#.........#.#...#.....#...#.#.#.#.#...#.......#.......#...#.........#...#.#.....#.#...............#',
'#.###.#.#.#.#.#.#################.#####.#.###.###.###.#.#.#.#####.###.#.#.#.###.#.#####.###.#######.#.#.#####.###.#.#.#####.#########.###.###',
'#.....#.#.#.#.#...#.............#.#.....#.#.....#.....#.#.#.#.#...#...#.#.#.#...#...#.#...#.#.....#...#.....#...#...#.#.....................#',
'#####.#.#.#.#.###.#.###########.#.#.###.#.#.#.#########.#.#.#.#.###.###.#.#.#######.#.###.#.#####.#####.#.#.###.#####.#######.###.#.#######.#',
'#.....#.#...#...#...#.....#...#...#.......#.#...........#.#.#.#.#.....#...#.#.....#.....#.#...#.........#.#.#.#.....#.........#...#...#.....#',
'#.#.###.#.###.#########.#.###.#####.#######.###########.#.#.#.#.#######.###.#.#.#####.###.###.#.#.#.#####.#.#.###.###.#.#######.#.###.#.###.#',
'#.#.....#.#...#.........#.#.......#.#.........#...#...#.#.#.....#.....#...#...#.#.....#...#.#.#.#.#.#.....#...#...#...#...#...#.......#.#...#',
'#.#.###.#.#####.###.#####.#.#######.#.###.#####.#.#.#.#.#.###.#.#.###.#########.#.#####.###.#.#.#.#.#.#########.#.#.###.#.#.###.#.#####.#####',
'#.#.#.......#...#...#.....#...............#.....#.#.#.#.#...........#.......#.#...#...#...#...#.#...#.#.........#.#...#.#.#.....#.....#.....#',
'#.#.#.#####.#.###.###.###########.#########.#####.#.#.#.###########.#####.#.#.#####.#.#.#.###.#.###.#.#.#########.###.###.#.#####.#.#.#.###.#',
'#...#...#...#.#.#.#.......#.....#.....#.........#...#...#...#...#.....#...#.......#.#...#...#...#.#.#.#.#...#.......#.....#...#...#.#.....#.#',
'#.#.#####.###.#.#.#######.#.###.###.#.#.#####.#.#######.###.#.#.#####.#.#.#######.#.#.#####.#.#.#.#.#.#.#.#.#################.#.#.#.#######.#',
'#.#.....#.....#.#...#.......#...#...#.#...#...#.......#.....#.#.#...#.#.#.#.....#...#.#.....#.........#...#.....#.........#.#.#.......#.....#',
'#.#.#.#.#.#####.###.#########.###.#.#.###.#.#####.###.#####.#.#.#.#.###.###.###.#######.#.###########.#########.#.#####.#.#.#.###.#####.#####',
'#.....#.#.....#.#...#...#.....#...#.....#.#.#...#...#.......#.#.#.#.#...#...#...........#.........#.........#.#.....#...#...#.#.......#.....#',
'###.###.#####.#.#.###.#.###.###########.#.###.#.#####.#######.#.#.#.#.###.###.###.#######.#####.#.#.#######.#.#######.#######.#.#.###.#.###.#',
'#.......#...#.#.#.....#...#.#...#...#.....#...#.....#.#...#...#...#.#.#...#.#.....#...#...#.#...#.#.#.....#...#.....#.......#.#.#.....#...#.#',
'#.#.#####.#.#.#.#########.#.#.#.#.#.#######.#######.###.#.#.#######.#.#####.#######.#.#.###.#.#.#.###.###.#####.###.#.#####.#.#.#.#.#######.#',
'#.#.....#.#.#...#...#...#.#...#...#.........#.#.......#.#...#...#.....#...........#.#.#...#.#.#.#.....#.#.....#.#.#.#.....#.#.#...#.....#...#',
'#.#.#.#.#.#.###.#.#.#.#.#.#.#######.#########.#.#####.#.#.###.#.#.###.#.###.#####.#.#.###.#.#.#.#######.#####.#.#.#.#######.#.###.#####.#.#.#',
'#...#.#...#...#.#.#...#.#.#.#.....#.#...#.....#.#...#...#.....#.#.#.....#.#.....#.#.#.....#...#.............#...#.#.....#...#...#...#.....#.#',
'###.#.#######.###.#####.#.###.###.#.#.#.#.#.###.#.#.#####.#####.#.#.#####.#####.#.#.#######.#########.#####.#####.#.###.#.#.###.#.#.#######.#',
'#.#.#...#...#...#.....#.#...#...#.#.#.#.#.#.....#.#.........#...#.#.......#...#.#.#...#.....#.........#...#...#.......#.#.#...........#.....#',
'#.#.#.#.#.#####.#####.#.###.###.#.###.#.#########.###########.###.#######.#.#.#.#.#.#.#.#######.###.#.#.#.###.#.#.#####.#.###.#.#.#.#.#####.#',
'#...#.#.#.....#.....#.#.....#...#.#...#.....#...#.#.....#...#.#...#.#.....#.#.#.#.....#.........#...#.#.#.#...#.#.......#...#.#...#.#.....#.#',
'#.#.###.#.###.#####.#.#####.#.###.#.#######.#.#.#.###.###.#.#.#.#.#.#.#####.#.#.#########.#######.###.#.#.#.###.###########.#.###.###.###.#.#',
'#...............#...#...#...#...#.#.#.......#.#.......#...#.#.#.....#.#.....#.#...#.......#...#.#.#.#.#.#.#.#...#...........#...#...#.#...#.#',
'#########.#####.#.#####.#.#####.#.#.#.#######.###.#####.#.#.#.#.#####.#.#####.###.#.#.#####.#.#.#.#.#.#.#.#.#.#.#####.#########.###.###.###.#',
'#.....#...#.......#.....#...#...#.#.#.#.....#.#...#.....#.....#...#...#.......#...#.#.#...#.#.#.....#...#.#...#.#.....#.#.....#.#.#...#...#.#',
'#.#.#.#####.#####.#.#.#######.###.#.#.#.###.#.###.#.#####.#######.#.#######.#.#.#.#.#.#.#.#.#.#.#######.#.#.###.#.#.###.#.#.###.#.###.###.###',
'#.#.#.......#.....#.#.#.......#.#...#.#...#.......#.#...#...#...#.#.......#...#.#.#.#...#...#.#...#...#.#.....#...#...#...#...#.....#...#...#',
'###.#######.#.#####.#.#.#######.#####.###.#########.#.#.#.#.###.#.#######.###.#.###.#########.###.#.#.#######.#######.#.#####.#####.###.###.#',
'#...#.....#.#.......#...#.....#.....#.......#.......#.#...#...#.....#...#.#...#.........#...#.#...#.#.................#...#.#...#.#...#...#.#',
'#.###.###.#.#.###.#########.###.###.#########.#####.#.#######.#.###.#.#.#.#.#.###########.#.#.#.###.#############.#.#####.#.#.#.#.###.###.#.#',
'#.#...#.#.#.#...#.#.......#.....#...#...#.....#.....#.#.....#.#.......#.#...#.#...#.......#...#.#...#.......#...#...#...#.#.#.#.....#...#...#',
'#.#.###.#.#####.#.#.#####.###.###.###.#.#.#######.###.#.###.#.#########.#####.#.#.#.###########.#.#.#.#####.#.#.#####.#.#.#.#.#########.#####',
'#.#.#...#.......#.#...#.#...#.#.#...#.#.#.#...........#.#.....#.....#.#...#.....#.#.#...#...#...#.#.#.#...#.#.#.......#.....#.........#.....#',
'#.#.###.###.#####.###.#.#.#.#.#.###.#.#.#.#.#########.#.#######.###.#.#.###.#######.#.###.#.#.###.###.###.#.#.#############.#######.#.#.#.###',
'#.#...#.........#...#...#...#.....#...#.#...#.......#.#.........#.#.#...#...#...#...#.#...#...#.#...#...#.#.#.#.......#...#.....#...#.#.#...#',
'#.###.###.#.###.###.#.#.#.#######.#####.#####.#####.#.#######.###.#.#####.###.#.#.###.#.#.#####.###.###.#.#.#.#.#.###.#.#.#.#####.#####.###.#',
'#...#.....#...#...#...#...#.....#.#.....#...#.#.#...#...#...#.#.............#.#.#...#.....#.......#.....#.#.....#...#.#.#.#.#.....#...#.....#',
'#.#.#.#####.#####.#####.###.###.###.###.#.#.#.#.#.#######.#.#.###.###########.#.#.#.#####.###.###.#######.#########.#.#.#.###.#####.#.#####.#',
'#.#.....#.......#.....#.#.....#...#.#.#.#.#...#...#.......#.#...#.#.....#.....#.#.#...#.........#.......#.........#.#.#.#.....#...#.#.....#.#',
'###.#.###.#.#.#######.#.#####.###.#.#.#.#.#####.#####.#####.###.#.#.###.#.#####.#####.#########.###.###.#.#######.#.###.#######.#.#.#####.#.#',
'#...#.#...#.#...#.....#.....#.#.#...#...#.#...#.......#.....#.........#.#.....#.....#.........#.....#.#.#.#.......#.#...#.....#.#.#.#...#...#',
'#.#.#.#.###.###.#.#######.#.#.#.###.#####.#.###########.#####.#####.#.#.###.#.#####.#.#######.#######.#.#.#.#.#####.#.###.###.#.#.#.#.#.#####',
'#...............#.#.......#...#.....#.....#.......#.....#...#.#...#...#.....#...#...#...#...#...#.....#...#.#.......#.....#...#.#...#.#.....#',
'#.#.#.#.#.#.###.#.#.###.#.###########.#####.###.#.#.#####.#.#.#.#.#.#######.###.#.#####.#.#####.#.#.#######.#.###.#.#######.###.#######.###.#',
'#.....#.#.#.....#.#...#.#.......#...#.....#.#...#.#.......#.#.#.#...#.....#...#.#.#.#...#.#...#.#.#.......#.#.....#.#.....#.#...#...#...#...#',
'#.#.#.#.#.#.###.#.#####.#######.#.#.#####.###.#############.#.#.#####.###.###.#.#.#.#.###.#.#.#.###.#####.#.###.###.#.#####.#.###.#.#.###.#.#',
'#.#.#...#.#...#.#.......#...#...#.#.#.....#...#.........#...#.#.#.#...#.#.....#.#.#.#...#.#.#.#...#.#.#...#...#...#...#.....#.#...#...#.#...#',
'#.#.#.###.###.#.#########.#.#.###.#.#.#####.#.#.#######.#.#####.#.#.###.#######.#.#.###.#.#.#.###.#.#.#.#####.#.#.#####.#####.#.#######.###.#',
'#.......#...#.#.#...#.....#.#.....#...#...............#.#.#.....#...#...........#.#.....#...#...#.#...#.....#.#.#.....#...#.....#.......#...#',
'###.###.###.#.#.#.#.###.###.###############.#.#.#.###.#.#.###.###.###.###.#######.#####.###.#.###.#.#####.#.#.#######.###.#.###.#.#####.#.#.#',
'#.....#.....#.#...#.....#.#.#.............#.....#.#...#.#...#.#.#...#...#.#.....#.....#...#.#.#...#.#...#.#.#.#.........#...#...#.....#.....#',
'#.###.#####.#.###########.#.#.###########.#####.#.#####.###.#.#.###.#####.#.###.###.#.###.###.#.#####.#.#.###.#.#######.#####.###.#########.#',
'#...#.#.#...#...#.........#.#.#.........#.....#...#...#.#...#.#.#...#...#.#.#.......#.#.#...#.#.......#.......#...#.....#...................#',
'###.#.#.#.#####.#########.#.#.#.#####.#######.#.###.#.#.#.###.#.#.###.#.#.#.#.###.###.#.###.#.#########.###.#.###.#.#####.#####.#.#######.#.#',
'#...#...#...#...#.........#.#.#...#...#.....#.#.#...#.#.#.....#.....#.#.#.#...#...#...#...#.#.....#...#...#.#.....#.#.....#.....#.....#.....#',
'#.###.#####.#.###.###.#####.#.#.#.#.#.#.#.#.#.###.###.#.#######.###.#.#.#.#.###.###.###.#.#.#####.#.#.###.#.#######.###.###.#####.#.#.#.#.#.#',
'#.#.#.#...#.#.#.......#.....#...#...#.#.#...#...#.#...#.......#.#...#.#...#.#...#...#.....#.#.....#.#.....#.........#...#...#.......#.#.....#',
'#.#.#.#.#.#.#.#.###.###.#######.#.#.###.#.#####.#.###.#.#####.#.#.###.#####.###.#.###.###.#.#.###.#.#######.#.#######.#.#.###.###.###.###.#.#',
'#.............#...#.....#.......#.#...#.#.....#.#...#.#.#.#...#.#.....#...#...#...#.....#.#.#.#...#.#...#.....#.......#.#.#...#.....#.#.....#',
'#.#####.#####.###.#########.#####.###.#.#####.#.###.#.#.#.#.###.#.#.#.#.#.#.#.###.#.#####.#.#.#####.#.###.#####.#####.###.#.#.#.#.###.#.#.#.#',
'#...#...#.#...#.#.....#.....#...#.#.#.#.....#.....#.#...#.#.....#.#.#.#.#...#.......#...#...#.#...#.#.#...#.........#.....#.#...............#',
'#.#.#.###.#.###.#####.#.#####.###.#.#.#.#########.#.#####.#####.#.#.#.#############.#.#.#.###.#.#.#.#.#.#########.#.#.#.###.#.###.#.#.###.#.#',
'#.#.#.....#.#.#.....#...#.........#.#.#.#.......#.......#.......#.#.#.#.........#...#...#.#...#.#...#.#.........#.#.#.#...#.#...#.#...#.....#',
'###.#.#####.#.#.#.#######.###.#####.#.#.#.#####.#######.#.#######.###.#.#######.###.#.#.#.#.###.#####.#########.#.#.#####.#####.#.#.###.###.#',
'#...#.#...#.#...#.......#.#.........#.#.#...#.#.......#.#.#.#.....#...#.......#...#.....#.#.#...#.........#.....#.#.#.....#...#.......#.#...#',
'#.###.#.#.#.#.#####.#.#.#.###.#######.#.###.#.#.#.###.#.#.#.#.#####.###.#########.#####.#.#.#.###.#######.#.#######.#.#####.#.###.#.#.#.#.###',
'#.#...#.#...#.#.....#.#.#...#...#.....#...#.#.#...#.#.#.....#...#.......#.......#.#...#.#...#...#.......#.#.......#...#.....#.......#.#.#.#.#',
'#.#.###.#######.###.#.#.###.#.#.#.#.#####.#.#.#####.#.#.#.#####.#.#.#####.#####.#.#.#.#.#######.#.#.#####.#######.#.###.###.#####.#.#.#.#.#.#',
'#...#.#.#.......#.#.....#...#.#...................#.#.#...#...#.#.#...#.#.#.#...#...#.#...#.....#.#...#...#.....#.#...#...#...#...#...#.#...#',
'#.###.#.###.#.###.#.#.###.#####.#.###.#.#.#.#.###.#.#.#.###.#.#.#.#.#.#.#.#.#.#######.###.#.#######.#.#.###.###.#.###.#.#####.#.#.#.#.#.###.#',
'#.#...#...#.#.#.....#...........#.#...#.#.#...#.....#.#.#...#...#.#.#.#.#.#...#.......#.#.#...#.....#...#...#...#.#.#.#.#.....#.#.....#.#...#',
'#.#.#.###.###.#######.#########.#.#.###.#.###.#.#####.###.#######.#.#.#.#.#.###.#######.#.###.#.###.#.###.###.#.#.#.#.###.#########.###.#####',
'#.#.#.#.#...#.........#...#...#.#.#...#.......#.#.....#...#...#.....#...#.#...#.#.......#.#...#.#...#...#.#...#.#.#.#...#.#.....#.....#.....#',
'#.#.#.#.###.#.#########.#.#.#.###.###.#########.#.###.#.###.#.#.###.###.#.###.#.#.#####.#.#.###.###.#.#.#.#.###.#.#.###.#.#.###.#.#.#.###.#.#',
'#...#...#...#.#.........#.#.#.#.....#.#.#.....#.#.#...#.#...#.#...#...#.#.#.#.#.#.....#.#.#...#...#.#.#.#.#.#...#.#.#...#.#...#...#.#...#.#.#',
'#####.#.#.###.#.###.#######.#.#.#####.#.#.###.#.#.#####.#.###.#####.#.#.#.#.#.#.#.###.#.#.###.###.###.#.#.#.#####.#.#.###.###.#####.###.###.#',
'#.....#...........#.#.......#.#.........#.#.#...#.#...#...#...#.....#.#.#.#.#...#...#.#.#...#...#.....#...#.....#.#.........#.#.....#...#...#',
'#.#.#.#.#.#.#.###.###.#######.###.#######.#.#####.#.#.#####.###.###.#.#.#.#.#####.#.#.#.###.###.#.###.#########.#.#######.###.#.###.#.###.#.#',
'#.....#.#.#.......#...#.............................#.....#.#...#.....#.#.#.#.....#.#.#...#.#...#...#.....#.#...#.........#...#...#.......#.#',
'#.#####.#.#########.###.#######.#.#.###.#.###.#.#####.#####.#.###.#.#####.#.#.#.###.#.#####.#.#####.###.#.#.#.###########.#.#####.#.#######.#',
'#S......#.............#...............#.......#.....#.........#...........#...#.....#.........#.........#...#...............#.....#.........#',
'#############################################################################################################################################',
];

// "#############################################################################################################################################",
// "#############################################################################################################################################",
// ];

// mapInput = [
// '###############',
// '#.......#....E#',
// '#.#.###.#.###.#',
// '#.....#.#...#.#',
// '#.###.#####.#.#',
// '#.#.#.......#.#',
// '#.#.#####.###.#',
// '#...........#.#',
// '###.#.#####.#.#',
// '#...#.....#.#.#',
// '#.#.#.###.#.#.#',
// '#.....#...#.#.#',
// '#.###.#.#.#.#.#',
// '#S..#.....#...#',
// '###############',
// ];
// mapInput = [
// '#################',
// '#...#...#...#..E#',
// '#.#.#.#.#.#.#.#.#',
// '#.#.#.#...#...#.#',
// '#.#.#.#.###.#.#.#',
// '#...#.#.#.....#.#',
// '#.#.#.#.#.#####.#',
// '#.#...#.#.#.....#',
// '#.#.#####.#.###.#',
// '#.#.#.......#...#',
// '#.#.###.#####.###',
// '#.#.#...#.....#.#',
// '#.#.#.#####.###.#',
// '#.#.#.........#.#',
// '#.#.#.#########.#',
// '#S#.............#',
// '#################',
// ];

const directions = {
  '>': [0, 1],
  '^': [-1, 0],
  'v': [1, 0],
  '<': [0, -1],
}

const goingBack = {
  '^': 'v',
  'v': '^',
  '>': '<',
  '<': '>',
}

let start = null;
let reindeer = null;
let finish = null;
let scores = {};


const map = mapInput.map((a, y) => a.split(''));

// console.log(map);

map.forEach((line, y) => {
  line.forEach((val, x ) => {
    if(val === 'S') {
      start = [y , x];
    }
    if(val === 'E') {
      finish = [y , x];
    }
  });
})
let seats = {};
let minimumScore = 0;

const calculateSeats = async (totalScore, stack = {}) => {
  // found a better route?
  if(!seats[totalScore]) {
    seats = {}; // start over
  }

  seats[totalScore] = seats[totalScore] || {};
  seats[totalScore] = {...seats[totalScore], ...stack};
}

const move = async (position, direction, stack = {}) => {
  let y = position[0];
  let x = position[1];
  let promises = [];

  let nrTurns = 0;
  let current = '>';

  for(let key in stack) {
    if(stack[key] !== current) {
      nrTurns++;
      current = stack[key];
    }
  }

  const totalScore = (Object.keys(stack).length) + nrTurns * 1000;

  if(scores?.[y + ',' + x]?.[direction] && scores[y + ',' + x][direction] < totalScore) {
    // console.log('iesim la scores', nrTurns, totalScore, scores[y + ',' + x]);
    // render(map, stack);
    return { found: false};
  }else if(!scores?.[y + ',' + x]?.[direction] || scores[y + ',' + x][direction] > totalScore){
    scores[y + ',' + x] = scores[y + ',' + x] || {};
    scores[y + ',' + x][direction] = totalScore;
  }

  if(
    minimumScore && // a solution found
    minimumScore < totalScore// Do not follow longer paths then an existing solution with fewer steps
  ) {
    // console.log('skip', nrTurns, position, direction, totalScore, minimumScore)
    // render(map, stack);
    // This will reduce complexity and number of checked paths
    return { found: false};
  }

  if(map?.[y]?.[x] === 'E') {
    minimumScore = totalScore;
    const newStack = {...stack, [y + ',' + x]: direction};
    calculateSeats(totalScore, newStack)
    console.log({totalScore, minimumScore, nrTurns });
    // render(map, stack);
    return { found: true, totalScore, stack: newStack };
  }
  // Do not make turns if possible - follow current line
  // Always try to not change direction first  | this will help find the right path quicker and reduces complexity
  let heading = directions[direction];
  let nextPosition = [y + heading[0], x + heading[1]];
  if((map?.[nextPosition[0]]?.[nextPosition[1]] === '.' || map?.[nextPosition[0]]?.[nextPosition[1]] === 'E') && !stack[nextPosition[0] + ',' + nextPosition[1]]) {
    promises.push(move(nextPosition, direction, {...stack, [y + ',' + x]: direction}));
  }else{

  }

  // Change direction
  for(let d in directions)  {
    if(d !== goingBack[direction] && d !== direction) { // not going back and front, only turn right or left
      let heading = directions[d];
      let nextPosition = [y + heading[0], x + heading[1]];
      if((map?.[nextPosition[0]]?.[nextPosition[1]] === '.' || map?.[nextPosition[0]]?.[nextPosition[1]] === 'E') && !stack[nextPosition[0] + ',' + nextPosition[1]]) {
        promises.push(move(nextPosition, d,  {...stack, [y + ',' + x]: d}));
      }
    }
  }

  return Promise.all(promises).then(solutions => {
    solutions = solutions.filter(a => a?.found);
    if(solutions.length) {
      solutions.sort((a, b) => a.totalScore - b.totalScore );
      return {found: true, totalScore: solutions[0].totalScore, stack: solutions[0].stack};
    }
    return {found: false}
  });
}

const render = (arr, existing = {}) => {
  for(let j = 0; j < arr.length; j++) {
    let str = '';
    for(let i = 0; i < arr[0].length; i++) {
      if(existing[j + ',' + i] && arr[j][i] !== 'S' && arr[j][i] !== 'E') {
        // str += existing[j + ',' + i];
        str += '+';
      }else{
        str += arr[j][i];
      }
    }
    console.log(str)
  }
  console.log('    ');
}

render(map);
reindeer = start;

move(reindeer, '>').then(({ stack, totalScore }) => {
  console.log('seats: ', Object.values(seats[totalScore]).length);

  console.log("final: ");
  render(map, seats[totalScore]);
  console.log("total: ", totalScore);

  console.timeEnd('run:');

});
