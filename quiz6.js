const mapData = [
".......#.........#..............#........................#......#....#............................#..#...............#............",
"...................#.............................................#...................................#............................",
"...............#.................................##.........#..........#.....##...#...#.....#....#..................#.............",
"#.............................................#..#.............#..........#.##.............................................#......",
"#.........................................................#.....#........................................##.......................",
"...........#.......#.#...........#....#.#...#......................................#...........................#...##............#",
"........................................................#..#.....................................#..#................#....#...#...",
"#.#.....#.........................#...........#.......................................#.......#.....................##............",
".......#..........##.....#........#..................................................#.........................................#.#",
"#.#..............#.#.............................#............#....#...............#.........................#............#..#.#.#",
"..........................................................#....................................................#..................",
".......................#....#...........#.....................#....#...#.......#..............#.......................#...........",
"..............................#..............#.......#....................................#.....................#...#...#.........",
"........#.................#...#....##..............#...........................#............................#.................#...",
"..................#........................................#......#......................................................#........",
".............#.................#...#..............................................................................#...#...........",
".....................................#..........................................................#.#.#......#.........#............",
"..........#...................................................................#.........##.......#..#.............................",
"...#.#....................................#..#...........#.......................................................##...............",
"........................................................................................................#.........................",
".........#...........#......#..............#........#....................#...#......#.............................................",
"........#....#...............#....................#..........#.....................................#......#......#........#.#.....",
"........................#..........................#.......#........................#................#......#.....................",
"......................................#.........................................#............................#....................",
"...................................#.#...#...........#.........................................#.....................#............",
".................#....#.....................................................................#..................#.........#........",
"...........#...........................................................#.............................#...............#..#.........",
"..#.....................#.........................................................................................................",
"....................#....#.#...........................#...........................................#..............#...............",
"...#...................................................#.............................................#.........#..........#.......",
".............................###.....#..#..#......................................................................................",
"##................#.#.......#..............#.....#...............#..#............#................................................",
"......#...............................................#.#..#............................#............#.................#..........",
"........................................#.#...................................................#.....#.............................",
"#.......#.#.......................#.....#....................................#...................#................................",
"...##................................................................................................#.....................#......",
"............#.............#..................#.................#..................................................................",
"...#..............#..............................................................................#..........#......#..............",
"...#..#...#................................................#.....................#......#......................#.......#..........",
".................#..#........#...............#.#................#......##.................#.................................#.....",
"#.....#.......#...........................................#..........#..............................#...#.#..#......#.....#.......",
"....................................#.........#........#..................#.............................................#.........",
"#...............................#........................#.................................................#.....#................",
"..#..................................#.......#.....................#..............................................................",
"........#...#.....................................#......#..............#..#..#..........................#.#....#.................",
".............#..........#....#................#.......#..........................................#.....#..........................",
".............................................#................................#.........................#...#.....................",
".........#........#...................................................................#.......#....#..............................",
"....................................#.......................#..............#...............................#......................",
"....#....................#................................#....#...........#.............#........................................",
"....#...........#...................#.#..................................................#.....................#..................",
"..........#....................#............#.##...#.......#....#...............#.....#...#.........................#.............",
".......#....................................................................................................#.................#...",
"...............................................................................#......#.................#...#.....................",
"..................#........#..........#..........................................................................#................",
"..........................................................................................#.......................................",
".#..#...........#.................................##...........................#.....#...................#..#.....................",
"........................#..#..........................................................#............#..................#..........#",
"...........#...................................................##...........................#...............................#.....",
"........#......................................................................................................#..................",
"........#..#............................#..#...........#..............................#......................#.##...........#....#",
"........#...#.#..............#...#.....................#....................#.#..............................#....................",
".......................................................#....................................................#..#..................",
"...........................................#......................#................#........................#....................#",
".............#...............#................................................................................#...................",
"..#...#............#.............#.....#........................#............#....................#...............................",
".....#...................................................................................................................#........",
"....................#..#...........#....#.............................................................................#.......#...",
"..............#......#.........................#...........#...#...........................................#...#..................",
"..............................#.....#.........................................................#......#.#......#...................",
"............................................................#...................#.#............................#..................",
".............###.#........................................#........................................................#..............",
"......#................................#...............##.........................................................................",
".........#.....#.#.....................#.......................................#...............#..........#....#....#.............",
"..............................................#....................................#...........................................#..",
"............#.#..........#........#..#.....#.............#..........#............#......#...................##..........#.........",
"............#....#...................................#.............................#.........................#....................",
".#..................................#....#.........................................................................#..............",
".........................#...#...#.................#..................#.............#.#...#...............#.......................",
".........#...............................#...........#.............................#...........................#..........#.......",
"......#..........................#.............#..........#.......................................................................",
".......#...............#.........#.............#...............................#..................................................",
"..#......#....................##...........................................#........................................#.............",
"..........................#.....#.......................#...........................................................#.#...........",
"..#....................#.............#................................................................#.#.........................",
".........#....................#.....#....#...............#.......................#........#.......................................",
"..............#...................................................................#................#...#..........................",
"....................#.....#.......#..#......................................#...........#..................................##....#",
".......#.......................................................................#..................................................",
"......#.............##..........................#..#......................^.......................................................",
"..............................#..........#...................#.................................#.....................#............",
".......................##..........................#.......#..............................#...................................#.#.",
"................#....................................................................#...............................#.........#..",
"..........................................#......#.....................................#................#........#................",
"#......................................#.......................................................#..#...........#...................",
".......#.............#..................#..#...#............#.......#.....#.....#.#...............................................",
".............................#........#.............#.....#.......#...................................#.#..................#......",
".................#......................................................................................#........#..#.............",
"........................................................................#..............#.....#..............................#.....",
"....#....#..........................................#......##...#....................#...................#..........#.............",
".................##.......................##.#.........#................................................#.........................",
".#..............................................#.........................#.#.#..........#.....................................##.",
"............................................................#..........#....#...................................................#.",
"....#...........#.............................#.....................#.........#..................#...........................#....",
"......#.#.......#..#......#........#..#...................#....#..................................................................",
"............#........................................................................................................#............",
".....................................................#..........................................#................#................",
"...#.......#..#..............#.............................#....................................#.................................",
".................##.........#........................#....................................#...............#.#.#...................",
"................#......#......................#..#..........................................#.....................................",
"......#..................................................##.#.#........#...........................#.......................#......",
"........................#............#......#.........#.............#.............................................#.....#.##......",
"......................#........................................#.......#.........#.................#..#...........#...............",
"..#.......#.........##..#.#................................................................................#.........#............",
"........................................................................................#............#...........#................",
"................#...#....................#..##..#...............#.............................................................#...",
"...#........#..........................#.....#..........................#....................................#.........#.......##.",
".................#...........................#.........#......#............................#.....................#................",
"...................#..........#....#.......#...................#.............................#..........#.........................",
".......#..............#.................................#.........#....................................#.................#....##.#",
"..................................#.......................#....#..#.........................#....................#................",
".....#.........#............#...#.........#........#...................#...#......................#.....#............#............",
"#.#....#...#........#................................##..........................#.............................##...#....#........",
".............##..........##...#......#.......#.#................#.#.......................#.............#.........................",
".............#....................................#....................................#..........................................",
"..................................#..............................#.......................................#................#.......",
"...................#...............#..............................................................................................",
"....#........#.................................#........#.....................................#.......#................#........#.",
".................#......#.......................................................##.....#..................#.......................",
"...............#.......................#.#........#...........................................#........#..........................",
]

// const mapData = [
//   "....#.....",
//   ".........#",
//   "..........",
//   "..#.......",
//   ".......#..",
//   "..........",
//   ".#..^.....",
//   "........#.",
//   "#.........",
//   "......#...",
// ]

const quardDirection = ['^', 'v', '>', '<'];
const directions = {
  '^': [-1, 0],
  '>': [0, 1],
  'v': [1, 0],
  '<': [0, -1],
}

let direction = null;
const map = mapData.map(row => row.split(''));

console.log(map);

// find guard
const findGuardPosition = () => {
  let position = [0, 0];
  map.forEach((line, x) => {
    line.forEach((val, y) => {
      if(quardDirection.indexOf(val) !== -1) {
        // Found guard
        position = [x, y];
        direction = val;
      }
    });
  })
  return position;
}

const testPosition = (x, y, dir) => {
  console.log('O: ', x, y, dir)
  let newX = x - directions[dir][0];
  let newY = y - directions[dir][1];
  let newDirection = changeDirection(dir);
  let newHeading = directions[newDirection];
  let isGood = true;
  let max = 0;
  let val;
  let samePoint;
  const hitPoints = {};

  const getMax = (obj) => {
    return Math.max(...Object.values(obj));
  }

  let loop = false;
  do {
    newX = newX + newHeading[0];
    newY = newY + newHeading[1];
    val = map?.[newX]?.[newY];
    if(val === '#' || (newX === x && newY === y)) {
      newDirection = changeDirection(newDirection);
      newHeading = directions[newDirection];
      console.log('OBS', newX, newY, newDirection)
      if(!hitPoints[newX + '_' + newY + '_' + newDirection]) {
        hitPoints[newX + '_' + newY + '_' + newDirection] = 0;
      }

      hitPoints[newX + '_' + newY + '_' + newDirection]++;
    }

    if(hitPoints[newX + '_' + newY + '_' + newDirection] > 4){
      console.log('suntem in loop', newX + '_' + newY + '_' + newDirection, hitPoints[newX + '_' + newY + '_' + newDirection]);
      loop = true;
    }
  }while(val && !loop);

  if(!val) {
    console.log('noObstacle')
    isGood = false;
  }

  return isGood;
}

const changeDirection = (val) => {
  const keys = Object.keys(directions);
  let currentKey = keys.indexOf(val);
  currentKey++;
  if(currentKey >= keys.length) {
    currentKey = 0;
  }
  return keys[currentKey];
}

let positions = 1;
let obstaclesCount = 0;
let obstacles = [];
const visitedPositions = [];

const move = (position) => {
  let processed = false;
  let guard = position;
  visitedPositions.push(guard[0] + '-' + guard[1]);
  let heading = directions[direction];
  let nextPosition, x, y;
  do {
    x = guard[0] + heading[0];
    y = guard[1] + heading[1];
    nextPosition = map?.[x]?.[y];
    console.log('heading', heading, guard, direction)
    // Something blocked
    if(nextPosition === '#') {
      direction = changeDirection(direction);
      heading = directions[direction];
      processed = true;
    } else {
      if(nextPosition) {
        if(!processed && testPosition(x, y, direction)) {
          // found good Obstacle
          if(!(guardPosition[0] === x && guardPosition[1] === y) && obstacles.indexOf(x + '-' + y) === -1) {
            obstaclesCount++
            obstacles.push(x + '-' + y);
          }
        }
        guard = [x, y];
        if(visitedPositions.indexOf(guard[0] + '-' + guard[1]) === -1) {
          positions++;
        }
        processed = false;
        visitedPositions.push(guard[0] + '-' + guard[1]);
      }
    }
  } while(nextPosition !== undefined)
}

const guardPosition = findGuardPosition();
console.log('guardPosition', guardPosition, );
move(guardPosition);
console.log(positions);
console.log('obstacles', obstacles, obstaclesCount);

//